# Golang CircleCI 2.0 configuration file
#
# Check https://circleci.com/docs/2.0/language-go/ for more details
version: 2
jobs:
  build:
    filters:
      tags:
        only: /^\d+\.\d+\.\d+$/
      branches:
        ignore: /.*/
    
    docker:
      - image: circleci/golang:1.9

    working_directory: /go/src/github.com/HashLoad/boss
    steps:
      - checkout

      # specify any bash command here prefixed with `run: `
      - run: go get -u -v -t github.com/Masterminds/glide
      - run: go get github.com/HashLoad/boss
      - run: go get -u github.com/tcnksm/ghr
      - run: glide install -v
      - run: go build -v -o dist/boss
      - run: ghr -t $GITHUB_TOKEN -u $CIRCLE_PROJECT_USERNAME -r $CIRCLE_PROJECT_REPONAME v1.0.$CIRCLE_BUILD_NUM dist || true   
      - store_artifacts:
          path: ./boss
          destination: boss-linux64
          
